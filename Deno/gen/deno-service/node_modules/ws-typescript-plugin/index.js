//required because original code doesn't work in embedded env
let path = require("path");
module.exports = function init({typescript}) {
  return {
    create(info) {
      let logger = info.project.projectService.logger;
      
      const getScriptFileNames = info.languageServiceHost.getScriptFileNames;
      info.languageServiceHost.getScriptFileNames = () => {
        const scriptFileNames = getScriptFileNames.call(info.languageServiceHost);
        const result = [...scriptFileNames];
        const libDenoDts = getDenoDtsPath() + "/lib.deno.d.ts";
        logger.info("Attached: " + libDenoDts)
        result.push(libDenoDts);
        const libWebworkerDts = getDenoDtsPath() + "/lib.webworker.d.ts";
        logger.info("Attached: " + libWebworkerDts)
        result.push(libWebworkerDts);
        return result;
      };
      
      return info.languageService;
    }
  }
}

function getDenoDtsPath() {
  return path.resolve(__dirname.substring(0, __dirname.lastIndexOf("/")) + "/typescript-deno-plugin/lib");
}